{
  "title": "Data Maintenance Feature",
  "description": "Add a Data Maintenance feature under Settings that allows administrators with ALL authority to permanently delete all data values for selected data elements across all organisation units and time periods.",
  "items": [
    {
      "id": "nested-sidebar-layout",
      "category": "Phase 1: NestedSidebar Component",
      "description": "Create NestedSidebarLayout component at /apps/modeling-app/src/components/NestedSidebar/NestedSidebarLayout.tsx with two-column layout wrapper (sidebar + content). Props: children, sidebar, backLinkTo (default '/'), backLinkText (default 'Back to app').",
      "stepsToVerify": [
        "File exists at /apps/modeling-app/src/components/NestedSidebar/NestedSidebarLayout.tsx",
        "Component accepts children, sidebar, backLinkTo, and backLinkText props",
        "Renders two-column layout with sidebar on left and content on right",
        "Back link navigates to backLinkTo prop value",
        "Dark theme styles copied from GuidesLayout.module.css"
      ],
      "passes": true
    },
    {
      "id": "nested-sidebar-nav",
      "category": "Phase 1: NestedSidebar Component",
      "description": "Create NestedSidebar component at /apps/modeling-app/src/components/NestedSidebar/NestedSidebar.tsx with generic navigation supporting categories and NavLinks. Props: categories array with items containing 'to' and 'label' properties.",
      "stepsToVerify": [
        "File exists at /apps/modeling-app/src/components/NestedSidebar/NestedSidebar.tsx",
        "Component accepts categories prop with SidebarCategory[] type",
        "Each category can have optional title and required items array",
        "Items render as NavLink components with 'to' and 'label' props",
        "Active link styling applied via NavLink className",
        "Styles copied from GuidesSidebar.module.css"
      ],
      "passes": true
    },
    {
      "id": "nested-sidebar-exports",
      "category": "Phase 1: NestedSidebar Component",
      "description": "Create barrel exports at /apps/modeling-app/src/components/NestedSidebar/index.ts exporting NestedSidebarLayout, NestedSidebar, and related types.",
      "stepsToVerify": [
        "File exists at /apps/modeling-app/src/components/NestedSidebar/index.ts",
        "Exports NestedSidebarLayout component",
        "Exports NestedSidebar component",
        "Exports SidebarItem, SidebarCategory, and prop types"
      ],
      "passes": true
    },
    {
      "id": "settings-sidebar",
      "category": "Phase 2: Settings Restructure",
      "description": "Create SettingsSidebar component using NestedSidebar with 'General' (/settings) and 'Data Maintenance' (/settings/data-maintenance) navigation items.",
      "stepsToVerify": [
        "File exists at /apps/modeling-app/src/features/settings/SettingsSidebar/SettingsSidebar.tsx",
        "Uses NestedSidebar component from components/NestedSidebar",
        "Categories include 'General' linking to '/settings'",
        "Categories include 'Data Maintenance' linking to '/settings/data-maintenance'",
        "Labels use i18n.t() for translation support"
      ],
      "passes": true
    },
    {
      "id": "general-settings",
      "category": "Phase 2: Settings Restructure",
      "description": "Create GeneralSettings component containing existing RouteSettings and ChapSettings components moved from Settings.tsx.",
      "stepsToVerify": [
        "File exists at /apps/modeling-app/src/features/settings/GeneralSettings/GeneralSettings.tsx",
        "Renders RouteSettings component",
        "Renders ChapSettings component",
        "Maintains existing layout and styling"
      ],
      "passes": true
    },
    {
      "id": "settings-layout",
      "category": "Phase 2: Settings Restructure",
      "description": "Create SettingsLayout component wrapping content with NestedSidebarLayout and rendering <Outlet /> for child routes.",
      "stepsToVerify": [
        "File exists at /apps/modeling-app/src/features/settings/SettingsLayout.tsx",
        "Uses NestedSidebarLayout component",
        "Passes SettingsSidebar as sidebar prop",
        "Renders <Outlet /> from react-router-dom for child routes",
        "Back link navigates to home ('/')"
      ],
      "passes": true
    },
    {
      "id": "data-maintenance-card",
      "category": "Phase 3: Data Maintenance Card",
      "description": "Create DataMaintenanceCard component with card title 'Data Maintenance', section 'Data Pruning', description explaining permanent deletion, and 'Go to Data Pruning' button navigating to /settings/data-maintenance/pruning.",
      "stepsToVerify": [
        "File exists at /apps/modeling-app/src/features/settings/DataMaintenance/DataMaintenanceCard/DataMaintenanceCard.tsx",
        "Card displays 'Data Maintenance' title",
        "Section displays 'Data Pruning' title",
        "Description explains pruning permanently deletes ALL data values for selected data elements",
        "Button labeled 'Go to Data Pruning' navigates to '/settings/data-maintenance/pruning'"
      ],
      "passes": true
    },
    {
      "id": "data-maintenance-authority",
      "category": "Phase 3: Data Maintenance Card",
      "description": "DataMaintenanceCard checks user authority using useAuthority hook with 'ALL' authority. Button disabled with tooltip for users without ALL authority.",
      "stepsToVerify": [
        "Uses useAuthority hook with { authority: 'ALL' }",
        "Button disabled when isSuperUser is false",
        "Tooltip appears on hover when button is disabled",
        "Tooltip explains authority requirement",
        "Button enabled when user has ALL authority"
      ],
      "passes": true
    },
    {
      "id": "data-element-selector",
      "category": "Phase 4: Data Pruning Page",
      "description": "Create DataElementSelector component adapted from SearchSelectField pattern. Queries /dataElements endpoint, filters out already-selected IDs via excludeIds prop, includes remove button when showRemoveButton is true, debounced search with 300ms delay.",
      "stepsToVerify": [
        "File exists at /apps/modeling-app/src/features/settings/DataMaintenance/DataPruning/DataElementSelector/DataElementSelector.tsx",
        "Queries /dataElements endpoint (not dataItems)",
        "Accepts excludeIds prop to filter already-selected items",
        "Accepts showRemoveButton prop to show/hide remove button",
        "Search input is debounced with 300ms delay",
        "Remove button (X) visible when showRemoveButton is true"
      ],
      "passes": true
    },
    {
      "id": "use-data-pruning-hook",
      "category": "Phase 4: Data Pruning Page",
      "description": "Create useDataPruning hook that sends POST requests to /maintenance/dataPruning/dataElements/{id} for each selected data element using Promise.allSettled. Returns array of { dataElement, success, error? } objects.",
      "stepsToVerify": [
        "File exists at /apps/modeling-app/src/features/settings/DataMaintenance/DataPruning/hooks/useDataPruning.ts",
        "Uses useMutation from TanStack Query",
        "Sends POST requests using dataEngine.mutate",
        "Uses Promise.allSettled to handle parallel requests",
        "Maps results to array with dataElement, success, and optional error properties"
      ],
      "passes": true
    },
    {
      "id": "confirm-pruning-modal",
      "category": "Phase 4: Data Pruning Page",
      "description": "Create ConfirmPruningModal with error NoticeBox warning, list of data elements to prune, input field requiring 'delete' (case-insensitive), destructive confirm button disabled until text matches.",
      "stepsToVerify": [
        "File exists at /apps/modeling-app/src/features/settings/DataMaintenance/DataPruning/ConfirmPruningModal/ConfirmPruningModal.tsx",
        "Error NoticeBox warns about irreversible action",
        "Lists all data elements to be pruned",
        "Input field requires typing 'delete' to enable confirm",
        "Case-insensitive matching (DELETE, Delete, delete all work)",
        "Confirm button uses destructive styling",
        "Confirm button disabled until text matches 'delete'",
        "Cancel button closes modal without action"
      ],
      "passes": false
    },
    {
      "id": "pruning-results-modal",
      "category": "Phase 4: Data Pruning Page",
      "description": "Create PruningResultsModal showing success/failure count, each data element with checkmark (success) or X (failure), error message for failed items, close button resets form.",
      "stepsToVerify": [
        "File exists at /apps/modeling-app/src/features/settings/DataMaintenance/DataPruning/PruningResultsModal/PruningResultsModal.tsx",
        "Displays success count and failure count",
        "Lists each data element with result indicator",
        "Successful items show checkmark icon",
        "Failed items show X icon with error message",
        "Close button returns to Data Pruning page",
        "Closing modal resets form state"
      ],
      "passes": false
    },
    {
      "id": "data-pruning-page-layout",
      "category": "Phase 4: Data Pruning Page",
      "description": "Create DataPruningPage with warning NoticeBox at top, initial state of one empty dropdown, ability to add up to 10 data elements, 'Add another data element' button hidden at 10 items.",
      "stepsToVerify": [
        "File exists at /apps/modeling-app/src/features/settings/DataMaintenance/DataPruning/DataPruningPage.tsx",
        "Warning NoticeBox (error style) displays at top of page",
        "Initial state shows one empty DataElementSelector",
        "'Add another data element' button visible when < 10 items",
        "'Add another data element' button hidden when 10 items",
        "Maximum of 10 data elements can be added"
      ],
      "passes": false
    },
    {
      "id": "data-pruning-page-interactions",
      "category": "Phase 4: Data Pruning Page",
      "description": "DataPruningPage allows searching and selecting data elements, prevents duplicates by passing selectedIds to exclude from each dropdown, shows remove button when > 1 item, hides remove when only 1 item.",
      "stepsToVerify": [
        "Can search and select data elements in dropdown",
        "Selected data element IDs passed as excludeIds to prevent duplicates",
        "Remove button (X) visible when more than 1 item exists",
        "Remove button hidden when only 1 item exists",
        "Removing an item removes it from the list"
      ],
      "passes": false
    },
    {
      "id": "data-pruning-page-actions",
      "category": "Phase 4: Data Pruning Page",
      "description": "DataPruningPage has Cancel button navigating back to Data Maintenance and 'Prune Data' button opening ConfirmPruningModal.",
      "stepsToVerify": [
        "Cancel button navigates to /settings/data-maintenance",
        "'Prune Data' button opens ConfirmPruningModal",
        "'Prune Data' button disabled when no data elements selected"
      ],
      "passes": false
    },
    {
      "id": "data-pruning-access-control",
      "category": "Phase 4: Data Pruning Page",
      "description": "DataPruningPage checks isSuperUser on page load. If unauthorized, shows access denied message with back button.",
      "stepsToVerify": [
        "Checks isSuperUser authority on component mount",
        "Unauthorized users see access denied message",
        "Access denied view includes back button",
        "Authorized users see the full pruning form"
      ],
      "passes": false
    },
    {
      "id": "router-configuration",
      "category": "Phase 5: Router Configuration",
      "description": "Update App.tsx router to add /settings route with SettingsLayout, index route for GeneralSettings, /settings/data-maintenance with index for DataMaintenanceCard, and /settings/data-maintenance/pruning for DataPruningPage.",
      "stepsToVerify": [
        "/settings path uses SettingsLayout as element",
        "/settings has handle: { collapseSidebar: true }",
        "/settings index route renders GeneralSettings",
        "/settings/data-maintenance index route renders DataMaintenanceCard",
        "/settings/data-maintenance/pruning renders DataPruningPage",
        "All routes properly nested under /settings parent"
      ],
      "passes": false
    },
    {
      "id": "settings-sidebar-navigation",
      "category": "Verification: Component Rendering",
      "description": "Settings page shows sidebar with 'General' and 'Data Maintenance' items, clicking items navigates correctly, 'Back to app' link navigates to home.",
      "stepsToVerify": [
        "Settings page displays sidebar",
        "Sidebar shows 'General' navigation item",
        "Sidebar shows 'Data Maintenance' navigation item",
        "Clicking 'General' shows RouteSettings and ChapSettings cards",
        "Clicking 'Data Maintenance' shows DataMaintenanceCard",
        "'Back to app' link navigates to home (/)"
      ],
      "passes": false
    },
    {
      "id": "authority-check-behavior",
      "category": "Verification: Authority Check",
      "description": "Users without ALL authority see disabled button with tooltip, users with ALL authority can click and navigate.",
      "stepsToVerify": [
        "User without ALL authority sees disabled 'Go to Data Pruning' button",
        "Tooltip appears on hover explaining authority requirement",
        "User with ALL authority sees enabled button",
        "Clicking enabled button navigates to /settings/data-maintenance/pruning"
      ],
      "passes": false
    },
    {
      "id": "pruning-form-behavior",
      "category": "Verification: Data Pruning Form",
      "description": "Data Pruning page form correctly manages data element selection, addition, removal, and duplicate prevention.",
      "stepsToVerify": [
        "Warning notice box displays at top of page",
        "Initial state shows one empty dropdown",
        "Can search and select data elements",
        "Can add up to 10 data elements",
        "Cannot add more than 10 (button hidden)",
        "Cannot add duplicate data elements (filtered from dropdown)",
        "Can remove individual items with X button",
        "X button hidden when only 1 item"
      ],
      "passes": false
    },
    {
      "id": "confirmation-flow",
      "category": "Verification: Confirmation Flow",
      "description": "Confirmation modal appears with data element list, requires typing 'delete', and handles cancellation correctly.",
      "stepsToVerify": [
        "Clicking 'Prune Data' opens confirmation modal",
        "Modal shows list of selected data elements",
        "'Delete Data' button disabled until 'delete' is typed",
        "Case-insensitive matching works (DELETE, Delete, delete all work)",
        "Cancel closes modal without action"
      ],
      "passes": false
    },
    {
      "id": "api-integration",
      "category": "Verification: API Integration",
      "description": "POST requests sent correctly for each data element, results modal shows success/failure status, closing results resets form.",
      "stepsToVerify": [
        "POST requests sent in parallel to /api/maintenance/dataPruning/dataElements/{uid}",
        "Results modal shows after all requests complete",
        "Success items show checkmark",
        "Failed items show X with error message",
        "Closing results modal resets form to initial state"
      ],
      "passes": false
    },
    {
      "id": "i18n-support",
      "category": "Cross-cutting: Internationalization",
      "description": "All user-facing strings wrapped with i18n.t() for translation support.",
      "stepsToVerify": [
        "Navigation labels use i18n.t()",
        "Card titles and descriptions use i18n.t()",
        "Button labels use i18n.t()",
        "Warning and error messages use i18n.t()",
        "Modal content uses i18n.t()"
      ],
      "passes": false
    },
    {
      "id": "guides-refactor",
      "category": "Phase 6: Optional Refactor",
      "description": "Update GuidesLayout.tsx to use the new NestedSidebarLayout component for code reuse.",
      "stepsToVerify": [
        "GuidesLayout.tsx imports NestedSidebarLayout from components/NestedSidebar",
        "Existing layout replaced with NestedSidebarLayout wrapper",
        "All existing functionality preserved",
        "Guides navigation continues to work correctly"
      ],
      "passes": false
    }
  ]
}
